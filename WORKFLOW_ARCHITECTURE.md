# Persona Insight Workflow Architecture

> μ‘μ„±μΌ: 2025-01-08
> λ²„μ „: 2.0 (SSE-based)

## π“‹ λ©μ°¨
1. [κ°μ”](#κ°μ”)
2. [λ°μ΄ν„° λ™κΈ°ν™” μ „λµ](#λ°μ΄ν„°-λ™κΈ°ν™”-μ „λµ)
3. [μΈν„°λ·° μ—…λ΅λ“ μ›ν¬ν”λ΅μ°](#μΈν„°λ·°-μ—…λ΅λ“-μ›ν¬ν”λ΅μ°)
4. [μ‹¤μ‹κ°„ ν†µμ‹  ν¨ν„΄](#μ‹¤μ‹κ°„-ν†µμ‹ -ν¨ν„΄)
5. [μ‹μ¤ν… μ•„ν‚¤ν…μ² λ„μ‹](#μ‹μ¤ν…-μ•„ν‚¤ν…μ²-λ„μ‹)
6. [μ„±λ¥ νΉμ„±](#μ„±λ¥-νΉμ„±)

## κ°μ”

Persona Insightλ” **SSE (Server-Sent Events) κΈ°λ° μ‹¤μ‹κ°„ μ•„ν‚¤ν…μ²**λ¥Ό μ±„νƒν•μ—¬ ν¨μ¨μ μΈ μ‹¤μ‹κ°„ μ—…λ°μ΄νΈλ¥Ό μ κ³µν•©λ‹λ‹¤. 
λ„¤νΈμ›ν¬ λΉ„μ©μ„ μµμ†ν™”ν•λ©΄μ„λ„ μ¦‰κ°μ μΈ μ—…λ°μ΄νΈλ¥Ό λ³΄μ¥ν•λ” μ„¤κ³„μ…λ‹λ‹¤.

### ν•µμ‹¬ νΉμ§•
- β… **SSE**: μ‹¤μ‹κ°„ μ΄λ²¤νΈ μ¤νΈλ¦¬λ° (λ°μ΄ν„° λ™κΈ°ν™” & AI μ‘λ‹µ)
- β… **Event-Driven**: μ΄λ²¤νΈ κΈ°λ° μ—…λ°μ΄νΈ
- β **Polling**: μ κ±°λ¨ (λ„¤νΈμ›ν¬ ν¨μ¨μ„±)
- β **WebSocket**: λ¶ν•„μ”ν• λ³µμ΅μ„± νν”Ό

## λ°μ΄ν„° λ™κΈ°ν™” μ „λµ

### 1. SSE κΈ°λ° μ‹¤μ‹κ°„ λ™κΈ°ν™” (μ£Όμ” λ°©μ‹)

```mermaid
graph LR
    Client[React Client] -->|μ΄κΈ° μ—°κ²°| SSE[SSE Endpoint]
    SSE -->|μ΄λ²¤νΈ μ¤νΈλ¦Ό| Client
    API[API Server] -->|μ΄λ²¤νΈ λ°μ†΅| SSE
    DB[(Database)] -->|λ³€κ²½ κ°μ§€| API
    
    style Client fill:#e1f5fe
    style SSE fill:#fff3e0
    style API fill:#f5f5f5
    style DB fill:#f3e5f5
```

#### SSE μ΄λ²¤νΈ μΆ…λ¥
| μ΄λ²¤νΈ | νƒ€μ… | μ©λ„ |
|--------|------|------|
| μΈν„°λ·° μ¶”κ°€ | `interview:added` | μƒ μΈν„°λ·° μƒμ„± μ‹ |
| μ²λ¦¬ μ™„λ£ | `interview:completed` | λ¶„μ„ μ™„λ£ μ‹ |
| μ²λ¦¬ μ‹¤ν¨ | `interview:failed` | λ¶„μ„ μ‹¤ν¨ μ‹ |
| μƒνƒ λ³€κ²½ | `interview:status_changed` | μƒνƒ μ—…λ°μ΄νΈ |
| μΈν„°λ·° μ‚­μ  | `interview:deleted` | μΈν„°λ·° μ‚­μ  μ‹ |

### 2. SSE μ—°κ²° κ΄€λ¦¬

```typescript
// ν΄λΌμ΄μ–ΈνΈ μ—°κ²° (use-sse-events.ts)
const eventSource = new EventSource(`/api/sse/projects/${projectId}`)

eventSource.onmessage = (event) => {
  const data = JSON.parse(event.data)
  // React Query μΊμ‹ μλ™ μ—…λ°μ΄νΈ
  queryClient.setQueryData(['interviews', projectId], ...)
}

// μλ™ μ¬μ—°κ²° (5μ΄ ν›„)
eventSource.onerror = () => {
  setTimeout(() => connect(), 5000)
}
```

## μΈν„°λ·° μ—…λ΅λ“ μ›ν¬ν”λ΅μ°

### μ „μ²΄ ν”„λ΅μ„Έμ¤ νλ¦„λ„

```mermaid
sequenceDiagram
    participant U as μ‚¬μ©μ
    participant UI as React UI
    participant SSE as SSE Connection
    participant API as API Server
    participant DB as Database
    participant MISO as MISO API

    Note over UI,SSE: SSE μ—°κ²° μ μ§€λ¨
    
    U->>UI: νμΌ μ„ νƒ/ν…μ¤νΈ μ…λ ¥
    UI->>API: POST /api/workflow/async
    
    API->>DB: μΈν„°λ·° μƒμ„± (status: processing)
    API->>SSE: μ΄λ²¤νΈ λ°μ†΅ (interview:added)
    SSE-->>UI: μ‹¤μ‹κ°„ λ©λ΅ μ—…λ°μ΄νΈ
    API-->>UI: μ¦‰μ‹ μ‘λ‹µ (interview_id)
    
    Note over API: 1μ΄ ν›„ λ°±κ·ΈλΌμ΄λ“ μ²λ¦¬
    
    API->>API: POST /api/workflow/process
    API->>MISO: μΈν„°λ·° λ¶„μ„ μ”μ²­
    MISO-->>API: λ¶„μ„ κ²°κ³Ό (μµλ€ 5λ¶„)
    API->>DB: κ²°κ³Ό μ €μ¥ (status: completed)
    API->>SSE: μ΄λ²¤νΈ λ°μ†΅ (interview:completed)
    SSE-->>UI: μ‹¤μ‹κ°„ μƒνƒ μ—…λ°μ΄νΈ
```

### μƒνƒ μ „μ΄λ„

```mermaid
stateDiagram-v2
    [*] --> Uploading: νμΌ μ„ νƒ
    Uploading --> Processing: μ—…λ΅λ“ μ™„λ£
    Processing --> Analyzing: MISO API νΈμ¶
    Analyzing --> Completed: λ¶„μ„ μ„±κ³µ
    Analyzing --> Failed: λ¶„μ„ μ‹¤ν¨
    Failed --> Processing: μ¬μ‹λ„
    Completed --> [*]
    
    note right of Processing
        μ¦‰μ‹ SSE μ΄λ²¤νΈ λ°μ†΅
        UI: μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ
    end note
    
    note right of Completed
        μ™„λ£ μ΄λ²¤νΈ λ°μ†΅
        UI: κ²°κ³Ό μ¦‰μ‹ ν‘μ‹
    end note
```

### API μ—”λ“ν¬μΈνΈ μ—­ν• 

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    /api/workflow/async                   β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ β€Ά νμΌ μμ‹  λ° κ²€μ¦                                      β”‚
β”‚ β€Ά DB λ μ½”λ“ μƒμ„± (status: processing)                   β”‚
β”‚ β€Ά SSE μ΄λ²¤νΈ λ°μ†΅ (interview:added) β­                  β”‚
β”‚ β€Ά μ¦‰μ‹ μ‘λ‹µ λ°ν™                                        β”‚
β”‚ β€Ά λ°±κ·ΈλΌμ΄λ“ μ²λ¦¬ νΈλ¦¬κ±°                                β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                            β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                   /api/workflow/process                  β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ β€Ά ν”„λ΅μ νΈ/νμ‚¬ μ»¨ν…μ¤νΈ λ΅λ“                           β”‚
β”‚ β€Ά MISO API νΈμ¶ (blocking)                              β”‚
β”‚ β€Ά λ¶„μ„ κ²°κ³Ό νμ‹± λ° DB μ €μ¥                             β”‚
β”‚ β€Ά SSE μ΄λ²¤νΈ λ°μ†΅ (completed/failed) β­                 β”‚
β”‚ β€Ά μ‹¤ν¨ μ‹ μ—λ¬ μ •λ³΄ ν¬ν•¨                                β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## μ‹¤μ‹κ°„ ν†µμ‹  ν¨ν„΄

### 1. SSE μ΄λ²¤νΈ μ‹μ¤ν… κµ¬μ΅°

```typescript
// μ„λ²„: μ΄λ²¤νΈ λ°μ†΅ (lib/sse/events.ts)
export class InterviewEvents {
  static async emitInterviewAdded(projectId: string, interview: any) {
    await SSEManager.broadcast(projectId, {
      type: SSEEventType.INTERVIEW_ADDED,
      data: { interview }
    })
  }
  
  static async emitProcessingCompleted(projectId: string, interviewId: string, result: any) {
    await SSEManager.broadcast(projectId, {
      type: SSEEventType.INTERVIEW_PROCESSING_COMPLETED,
      data: { interviewId, result }
    })
  }
}

// ν΄λΌμ΄μ–ΈνΈ: μ΄λ²¤νΈ μμ‹  (use-sse-events.ts)
const handleEvent = (event: MessageEvent) => {
  const data = JSON.parse(event.data)
  
  switch (data.type) {
    case SSEEventType.INTERVIEW_ADDED:
      // React Query μΊμ‹μ— μƒ μΈν„°λ·° μ¶”κ°€
      queryClient.setQueryData(['interviews', projectId], ...)
      toast.success('μƒ μΈν„°λ·°κ°€ μ¶”κ°€λμ—μµλ‹λ‹¤')
      break
      
    case SSEEventType.INTERVIEW_PROCESSING_COMPLETED:
      // μΈν„°λ·° μƒνƒ μ—…λ°μ΄νΈ
      queryClient.setQueryData(['interviews', projectId], ...)
      toast.success('μΈν„°λ·° λ¶„μ„μ΄ μ™„λ£λμ—μµλ‹λ‹¤')
      break
  }
}
```

### 2. AI μ±„ν… μ¤νΈλ¦¬λ° (SSE)

```typescript
// λ™μΌν• SSE μΈν”„λΌ ν™μ©
const streamChat = async (messages: ChatMessage[]) => {
  const response = await fetch('/api/chat', {
    method: 'POST',
    body: JSON.stringify({ messages })
  })
  
  // SSE μ¤νΈλ¦Ό μ²λ¦¬
  const reader = response.body?.getReader()
  while (true) {
    const { done, value } = await reader.read()
    if (done) break
    // μ‹¤μ‹κ°„ ν…μ¤νΈ λ λ”λ§
  }
}
```

## μ‹μ¤ν… μ•„ν‚¤ν…μ² λ„μ‹

### μ „μ²΄ μ•„ν‚¤ν…μ²

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                         Frontend (Next.js)                       β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚ React Query  β”‚  β”‚ SSE Client   β”‚  β”‚  Event Handlers    β”‚   β”‚
β”‚  β”‚  (μΊμ‹±)      β”‚  β”‚ (EventSource)β”‚  β”‚  (μλ™ μ—…λ°μ΄νΈ)    β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                              β†“ SSE Stream
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                      API Routes (Next.js)                        β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β”‚  β”‚ SSE Endpoint β”‚  β”‚ Event System β”‚  β”‚  Workflow APIs     β”‚   β”‚
β”‚  β”‚  /api/sse/*  β”‚  β”‚  (Emitters)  β”‚  β”‚   (Processors)     β”‚   β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β”‚
                    β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                    β†“                   β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚      Supabase          β”‚  β”‚       MISO API          β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ β€Ά PostgreSQL DB        β”‚  β”‚ β€Ά Interview Analysis    β”‚
β”‚ β€Ά Authentication       β”‚  β”‚ β€Ά Persona Generation    β”‚
β”‚ β€Ά Row Level Security   β”‚  β”‚ β€Ά AI Chat Agent         β”‚
β”‚ β€Ά File Storage         β”‚  β”‚ β€Ά Knowledge Base        β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### λ°μ΄ν„° νλ¦„ λΉ„κµ

```
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
  μ΄μ „ μ‹μ¤ν… (Polling)           ν„μ¬ μ‹μ¤ν… (SSE)
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
  Client β†’ HTTP β†’ Server         Client β† SSE β† Server
    β†‘        β†“                     β†‘              β†“
   30s      DB                   Event          DB
    β””β”€β”€β”€β”€β”€β”€β”€β”€β”                     β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
  (Polling Loop)                 (Push on Change)
β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”
```

## μ„±λ¥ νΉμ„±

### μ¥μ  β…
1. **μ‹¤μ‹κ°„μ„±**: μ¦‰κ°μ μΈ μ—…λ°μ΄νΈ (λ°€λ¦¬μ΄ λ‹¨μ„)
2. **ν¨μ¨μ„±**: 98% λ„¤νΈμ›ν¬ νΈλν”½ κ°μ†
3. **UX**: λκΉ€ μ—†λ” μ‹¤μ‹κ°„ κ²½ν—
4. **ν™•μ¥μ„±**: μ΄λ²¤νΈ κΈ°λ° μ•„ν‚¤ν…μ²

### μ„±λ¥ λΉ„κµ
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚         λ„¤νΈμ›ν¬ ν¨μ¨μ„± λΉ„κµ         β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ Polling (μ΄μ „):                     β”‚
β”‚ β€Ά μ‚¬μ©μ: 100λ…                     β”‚
β”‚ β€Ά μ”μ²­: 120ν/μ‹κ°„/μ‚¬μ©μ           β”‚
β”‚ β€Ά μ΄ μ”μ²­: 12,000/μ‹κ°„              β”‚
β”‚                                     β”‚
β”‚ SSE (ν„μ¬):                         β”‚
β”‚ β€Ά μ—°κ²°: 100κ° (μ§€μ†)                β”‚
β”‚ β€Ά μ΄λ²¤νΈ: ~100ν/μ‹κ°„ (μ‹¤μ  λ³€κ²½μ‹) β”‚
β”‚ β€Ά 98% νΈλν”½ κ°μ† β¨                β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### SSE μ—°κ²° κ΄€λ¦¬
```typescript
// SSE Manager (lib/sse/manager.ts)
class SSEManagerClass {
  // ν”„λ΅μ νΈλ³„ ν΄λΌμ΄μ–ΈνΈ κ΄€λ¦¬
  private clients: Map<string, Map<string, SSEClient>> = new Map()
  
  // Keep-alive: 30μ΄λ§λ‹¤ ping
  private startKeepAlive(projectId: string) {
    setInterval(() => {
      this.broadcast(projectId, { type: 'ping' })
    }, 30000)
  }
  
  // μλ™ μ •λ¦¬
  removeClient(projectId: string, clientId: string) {
    // μ—°κ²° μΆ…λ£ μ‹ μλ™ μ •λ¦¬
  }
}
```

## μ£Όμ” μ‹λ‚λ¦¬μ¤λ³„ νλ¦„

### μ‹λ‚λ¦¬μ¤ 1: μΈν„°λ·° μ—…λ΅λ“ λ° μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ

```
μ‹κ°„ β†’
00:00 β”β”€β”€β”€β”€β”€β” νμΌ μ—…λ΅λ“
      β”‚ π‘¤A β”‚ β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β†’ [Upload API]
      β””β”€β”€β”€β”€β”€β”                     β†“
                            [SSE: interview:added]
                                  β†“
00:00.1 β”β”€β”€β”€β”€β”€β”            μ¦‰μ‹ λ©λ΅ κ°±μ‹  β¨
        β”‚ π‘¤B β”‚ β†β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
        β””β”€β”€β”€β”€β”€β”
                            [λ°±κ·ΈλΌμ΄λ“ μ²λ¦¬μ¤‘...]
                                  β†“
00:45 β”β”€β”€β”€β”€β”€β”              
      β”‚ π‘¤A β”‚ β†β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€ [SSE: interview:completed]
      β””β”€β”€β”€β”€β”€β”                     
      β”β”€β”€β”€β”€β”€β”              λ™μ‹ μ—…λ°μ΄νΈ β¨
      β”‚ π‘¤B β”‚ β†β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€
      β””β”€β”€β”€β”€β”€β”
```

### μ‹λ‚λ¦¬μ¤ 2: λ‹¤μ¤‘ μ‚¬μ©μ μ‹¤μ‹κ°„ ν‘μ—…

```
User A                    Server                    User B
  β”‚                         β”‚                         β”‚
  β”β”€β”€β”€ μΈν„°λ·° μ¶”κ°€ β”€β”€β”€β”€β”€β”€β”€β”€β†’β”‚                         β”‚
  β”‚                         β”β”€β”€β”€ DB μ €μ¥              β”‚
  β”‚                         β”β”€β”€β”€ SSE μ΄λ²¤νΈ β”€β”€β”€β”€β”€β”€β”€β”€β”€β†’β”‚
  β”‚β†β”€β”€β”€ λ©λ΅ κ°±μ‹  β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤                    (μ¦‰μ‹ λ°μ)
  β”‚                         β”‚                         β”‚
  β”‚                    (μ‹¤μ‹κ°„ λ™κΈ°ν™”)                β”‚
```

### μ‹λ‚λ¦¬μ¤ 3: μ—°κ²° λ³µκµ¬ λ° μƒνƒ λ™κΈ°ν™”

```
μ—°κ²° λκΉ€ β†’ 5μ΄ ν›„ μλ™ μ¬μ—°κ²° β†’ μ΄κΈ° λ°μ΄ν„° λ΅λ“ β†’ SSE μ¬κµ¬λ…
     β†“
μΌμ‹μ  μ¤ν”„λΌμΈ
     β†“
λ³µκµ¬ μ‹ λ†“μΉ μ΄λ²¤νΈλ” μ΄κΈ° λ΅λ“λ΅ λ³΄μ™„
```

## κΈ°μ  μ¤νƒλ³„ μ—­ν• 

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                  Frontend κΈ°μ                       β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ β€Ά EventSource API: SSE ν΄λΌμ΄μ–ΈνΈ                  β”‚
β”‚ β€Ά React Query: μΊμ‹ κ΄€λ¦¬ λ° μ΄κΈ° λ°μ΄ν„° λ΅λ“       β”‚
β”‚ β€Ά Custom Hooks: SSE μ΄λ²¤νΈ μ²λ¦¬ λ΅μ§              β”‚
β”‚ β€Ά Auto-reconnect: μ—°κ²° λ³µκµ¬ λ΅μ§                  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”

β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                  Backend κΈ°μ                        β”‚
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¤
β”‚ β€Ά SSE Endpoints: μ‹¤μ‹κ°„ μ¤νΈλ¦Ό μ κ³µ               β”‚
β”‚ β€Ά Event System: κµ¬μ΅°ν™”λ μ΄λ²¤νΈ λ°μ†΅              β”‚
β”‚ β€Ά Connection Manager: ν΄λΌμ΄μ–ΈνΈ μ—°κ²° κ΄€λ¦¬         β”‚
β”‚ β€Ά Keep-alive: μ—°κ²° μ μ§€ λ©”μ»¤λ‹μ¦                  β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## λ¨λ‹ν„°λ§ ν¬μΈνΈ

### μ£Όμ” μ§€ν‘
- **ν™μ„± μ—°κ²° μ**: ν”„λ΅μ νΈλ³„ SSE μ—°κ²°
- **μ΄λ²¤νΈ μ²λ¦¬λ‰**: μ΄λ‹Ή μ΄λ²¤νΈ μ
- **μ—°κ²° μ•μ •μ„±**: μ¬μ—°κ²° λΉλ„
- **λ μ΄ν„΄μ‹**: μ΄λ²¤νΈ λ°μƒ-μμ‹  μ‹κ°„

### λ””λ²„κΉ… λ„κµ¬
```typescript
// SSE μ—°κ²° μƒνƒ λ¨λ‹ν„°λ§
const SSEDebugger = {
  connections: new Map(),
  events: [],
  
  logConnection: (projectId: string, status: string) => {
    console.log(`[SSE] Project ${projectId}: ${status}`)
  },
  
  logEvent: (type: string, data: any) => {
    console.log(`[SSE Event] ${type}:`, data)
  }
}
```

## κ²°λ΅ 

Persona Insightλ” **μ™„μ „ν• SSE κΈ°λ° μ‹¤μ‹κ°„ μ•„ν‚¤ν…μ²**λ΅ μ „ν™λμ–΄,
λ„¤νΈμ›ν¬ ν¨μ¨μ„±κ³Ό μ‚¬μ©μ κ²½ν—μ„ ν¬κ² κ°μ„ ν–μµλ‹λ‹¤. 

### ν•µμ‹¬ μ •λ¦¬
- π“΅ **SSE**: λ¨λ“  μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ (λ°μ΄ν„° & AI)
- π€ **μ¦‰μ‹ λ°μ**: λ°€λ¦¬μ΄ λ‹¨μ„ μ—…λ°μ΄νΈ
- π’° **98% λΉ„μ© μ κ°**: λ„¤νΈμ›ν¬ νΈλν”½ μµμ†ν™”
- π”„ **μλ™ λ³µκµ¬**: μ—°κ²° λκΉ€ μ‹ μλ™ μ¬μ—°κ²°

μ΄ μ•„ν‚¤ν…μ²λ” **"Efficient Real-time"** μ² ν•™μ„ λ”°λ¥΄λ©°,
λ‹¨μν•λ©΄μ„λ„ κ°•λ ¥ν• μ‹¤μ‹κ°„ μ‹μ¤ν…μ„ κµ¬μ¶•ν–μµλ‹λ‹¤.